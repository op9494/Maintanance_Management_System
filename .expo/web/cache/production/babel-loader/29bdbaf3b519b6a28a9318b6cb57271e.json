{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{PermissionStatus}from\"./Permissions.types\";function _getUserMedia(constraints){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){return navigator.mediaDevices.getUserMedia(constraints);}var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||function(){var error=new Error('Permission unimplemented');error.code=0;error.name='NotAllowedError';throw error;};return new Promise(function(resolve,reject){getUserMedia.call(navigator,constraints,resolve,reject);});}function askForMediaPermissionAsync(options){var message;return _regeneratorRuntime.async(function askForMediaPermissionAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(_getUserMedia(options));case 3:return _context.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never'});case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);message=_context.t0.message;if(!(message==='Permission dismissed')){_context.next=13;break;}return _context.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never'});case 13:return _context.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never'});case 14:case\"end\":return _context.stop();}}},null,null,[[0,6]]);}function askForMicrophonePermissionAsync(){return _regeneratorRuntime.async(function askForMicrophonePermissionAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(askForMediaPermissionAsync({audio:true}));case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}});}function askForCameraPermissionAsync(){return _regeneratorRuntime.async(function askForCameraPermissionAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(askForMediaPermissionAsync({video:true}));case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}});}function askForLocationPermissionAsync(){return _regeneratorRuntime.async(function askForLocationPermissionAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",new Promise(function(resolve){navigator.geolocation.getCurrentPosition(function(){return resolve({status:PermissionStatus.GRANTED,expires:'never'});},function(_ref2){var code=_ref2.code;if(code===1){resolve({status:PermissionStatus.DENIED,expires:'never'});}else{resolve({status:PermissionStatus.UNDETERMINED,expires:'never'});}});}));case 1:case\"end\":return _context4.stop();}}});}function getPermissionAsync(permission,shouldAsk){var _window,_window$Notification,Notification,status,_window2,_window2$navigator,_navigator,_await$_navigator$per,state;return _regeneratorRuntime.async(function getPermissionAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.t0=permission;_context5.next=_context5.t0==='userFacingNotifications'?3:_context5.t0==='notifications'?3:_context5.t0==='location'?14:_context5.t0==='audioRecording'?34:_context5.t0==='camera'?41:48;break;case 3:_window=window,_window$Notification=_window.Notification,Notification=_window$Notification===void 0?{}:_window$Notification;if(!Notification.requestPermission){_context5.next=13;break;}status=Notification.permission;if(!shouldAsk){_context5.next=10;break;}_context5.next=9;return _regeneratorRuntime.awrap(Notification.requestPermission());case 9:status=_context5.sent;case 10:if(!(!status||status==='default')){_context5.next=12;break;}return _context5.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never'});case 12:return _context5.abrupt(\"return\",{status:status,expires:'never'});case 13:return _context5.abrupt(\"break\",49);case 14:_window2=window,_window2$navigator=_window2.navigator,_navigator=_window2$navigator===void 0?{}:_window2$navigator;if(!_navigator.permissions){_context5.next=29;break;}_context5.next=18;return _regeneratorRuntime.awrap(_navigator.permissions.query({name:'geolocation'}));case 18:_await$_navigator$per=_context5.sent;state=_await$_navigator$per.state;if(!(state!==PermissionStatus.GRANTED&&state!==PermissionStatus.DENIED)){_context5.next=26;break;}if(!shouldAsk){_context5.next=25;break;}_context5.next=24;return _regeneratorRuntime.awrap(askForLocationPermissionAsync());case 24:return _context5.abrupt(\"return\",_context5.sent);case 25:return _context5.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never'});case 26:return _context5.abrupt(\"return\",{status:state,expires:'never'});case 29:if(!shouldAsk){_context5.next=33;break;}_context5.next=32;return _regeneratorRuntime.awrap(askForLocationPermissionAsync());case 32:return _context5.abrupt(\"return\",_context5.sent);case 33:return _context5.abrupt(\"break\",49);case 34:if(!shouldAsk){_context5.next=40;break;}_context5.next=37;return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());case 37:return _context5.abrupt(\"return\",_context5.sent);case 40:return _context5.abrupt(\"break\",49);case 41:if(!shouldAsk){_context5.next=47;break;}_context5.next=44;return _regeneratorRuntime.awrap(askForCameraPermissionAsync());case 44:return _context5.abrupt(\"return\",_context5.sent);case 47:return _context5.abrupt(\"break\",49);case 48:return _context5.abrupt(\"break\",49);case 49:return _context5.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never'});case 50:case\"end\":return _context5.stop();}}});}export default{get name(){return'ExpoPermissions';},getAsync:function getAsync(permissionTypes){var results,_iterator,_isArray,_i,_ref3,_permissionType;return _regeneratorRuntime.async(function getAsync$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:results={};_iterator=new Set(permissionTypes),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol===\"function\"?typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\":\"@@iterator\"]();case 2:if(!_isArray){_context6.next=8;break;}if(!(_i>=_iterator.length)){_context6.next=5;break;}return _context6.abrupt(\"break\",18);case 5:_ref3=_iterator[_i++];_context6.next=12;break;case 8:_i=_iterator.next();if(!_i.done){_context6.next=11;break;}return _context6.abrupt(\"break\",18);case 11:_ref3=_i.value;case 12:_permissionType=_ref3;_context6.next=15;return _regeneratorRuntime.awrap(getPermissionAsync(_permissionType,false));case 15:results[_permissionType]=_context6.sent;case 16:_context6.next=2;break;case 18:return _context6.abrupt(\"return\",results);case 19:case\"end\":return _context6.stop();}}});},askAsync:function askAsync(permissionTypes){var results,_iterator2,_isArray2,_i2,_ref4,_permissionType2;return _regeneratorRuntime.async(function askAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:results={};_iterator2=new Set(permissionTypes),_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[typeof Symbol===\"function\"?typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\":\"@@iterator\"]();case 2:if(!_isArray2){_context7.next=8;break;}if(!(_i2>=_iterator2.length)){_context7.next=5;break;}return _context7.abrupt(\"break\",18);case 5:_ref4=_iterator2[_i2++];_context7.next=12;break;case 8:_i2=_iterator2.next();if(!_i2.done){_context7.next=11;break;}return _context7.abrupt(\"break\",18);case 11:_ref4=_i2.value;case 12:_permissionType2=_ref4;_context7.next=15;return _regeneratorRuntime.awrap(getPermissionAsync(_permissionType2,true));case 15:results[_permissionType2]=_context7.sent;case 16:_context7.next=2;break;case 18:return _context7.abrupt(\"return\",results);case 19:case\"end\":return _context7.stop();}}});}};","map":{"version":3,"sources":["../src/ExpoPermissions.web.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  PermissionInfo,\n  PermissionMap,\n  PermissionStatus,\n  PermissionType,\n} from './Permissions.types';\n\n/*\n * TODO: Bacon: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Permissions\n * Add messages to manifest like we do with iOS info.plist\n */\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nfunction _getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    navigator.getUserMedia ||\n    (navigator as any).webkitGetUserMedia ||\n    (navigator as any).mozGetUserMedia ||\n    function() {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nasync function askForMediaPermissionAsync(\n  options: MediaStreamConstraints\n): Promise<PermissionInfo> {\n  try {\n    await _getUserMedia(options);\n    return { status: PermissionStatus.GRANTED, expires: 'never' };\n  } catch ({ message }) {\n    // name: NotAllowedError\n    // code: 0\n    if (message === 'Permission dismissed') {\n      // message: Permission dismissed\n      return { status: PermissionStatus.UNDETERMINED, expires: 'never' };\n    } else {\n      // TODO: Bacon: [OSX] The system could deny access to chrome.\n      // TODO: Bacon: add: { status: 'unimplemented' }\n      // message: Permission denied\n      return { status: PermissionStatus.DENIED, expires: 'never' };\n    }\n  }\n}\n\nasync function askForMicrophonePermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ audio: true });\n}\n\nasync function askForCameraPermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ video: true });\n}\n\nasync function askForLocationPermissionAsync(): Promise<PermissionInfo> {\n  return new Promise(resolve => {\n    navigator.geolocation.getCurrentPosition(\n      () => resolve({ status: PermissionStatus.GRANTED, expires: 'never' }),\n      ({ code }: PositionError) => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/PositionError/code\n        if (code === 1) {\n          resolve({ status: PermissionStatus.DENIED, expires: 'never' });\n        } else {\n          resolve({ status: PermissionStatus.UNDETERMINED, expires: 'never' });\n        }\n      }\n    );\n  });\n}\n\nasync function getPermissionAsync(\n  permission: PermissionType,\n  shouldAsk: boolean\n): Promise<PermissionInfo> {\n  switch (permission) {\n    case 'userFacingNotifications':\n    case 'notifications':\n      {\n        const { Notification = {} } = window as any;\n        if (Notification.requestPermission) {\n          let status = Notification.permission;\n          if (shouldAsk) {\n            status = await Notification.requestPermission();\n          }\n          if (!status || status === 'default') {\n            return { status: PermissionStatus.UNDETERMINED, expires: 'never' };\n          }\n          return { status, expires: 'never' };\n        }\n      }\n      break;\n    case 'location':\n      {\n        const { navigator = {} } = window as any;\n        if (navigator.permissions) {\n          const { state } = await navigator.permissions.query({ name: 'geolocation' });\n          if (state !== PermissionStatus.GRANTED && state !== PermissionStatus.DENIED) {\n            if (shouldAsk) {\n              return await askForLocationPermissionAsync();\n            }\n            return { status: PermissionStatus.UNDETERMINED, expires: 'never' };\n          }\n\n          return { status: state, expires: 'never' };\n        } else if (shouldAsk) {\n          // TODO: Bacon: should this function as ask async when not in chrome?\n          return await askForLocationPermissionAsync();\n        }\n      }\n      break;\n    case 'audioRecording':\n      if (shouldAsk) {\n        return await askForMicrophonePermissionAsync();\n      } else {\n        //TODO: Bacon: Is it possible to get this permission?\n      }\n      break;\n    case 'camera':\n      if (shouldAsk) {\n        return await askForCameraPermissionAsync();\n      } else {\n        //TODO: Bacon: Is it possible to get this permission?\n      }\n      break;\n    default:\n      break;\n  }\n  return { status: PermissionStatus.UNDETERMINED, expires: 'never' };\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoPermissions';\n  },\n\n  async getAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ false);\n    }\n    return results;\n  },\n\n  async askAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ true);\n    }\n    return results;\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}